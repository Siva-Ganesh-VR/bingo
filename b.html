<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player B</title>

<style>
body { font-family: Arial; text-align:center; padding:20px; }

.grid{
 display:grid;
 grid-template-columns:repeat(5,60px);
 gap:5px;
 justify-content:center;
 margin:20px auto;
}

.cell{
 width:60px;height:60px;line-height:60px;
 border:1px solid #000;font-size:20px;
}

.A{background:#1e90ff;color:white;} /* blue */
.B{background:#2ecc71;color:white;} /* green */
.win{outline:4px solid yellow;}

#bingo{font-size:32px;font-weight:bold;letter-spacing:8px;}
#winner{font-size:22px;color:red;margin:10px;}

.fire{
 position:fixed;inset:0;
 background:radial-gradient(circle,#fff 2px,transparent 3px);
 animation:boom 1s infinite;
 opacity:.6;display:none;pointer-events:none;
}

@keyframes boom{
 from{transform:scale(0);}
 to{transform:scale(4);opacity:0;}
}
</style>
</head>

<body>

<div class="fire" id="fx"></div>

<h2>ðŸŸ¢ Player B</h2>
<div id="turn"></div>
<div id="bingo"></div>
<div id="winner"></div>

<div class="grid" id="board"></div>

<input id="num" type="number" min="1" max="25">
<button onclick="call()">Call</button>
<button onclick="resetGame()">Reset</button>

<h3>Numbers Called:</h3>
<div id="log"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, set, remove, onValue, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const config={
 apiKey:"AIzaSyCdcOpVzbZwKkbiSTHfsbYIecRuDbq9uns",
 authDomain:"bingo-sgthegreat.firebaseapp.com",
 databaseURL:"https://bingo-sgthegreat-default-rtdb.firebaseio.com",
 projectId:"bingo-sgthegreat"
};

const app=initializeApp(config);
const db=getDatabase(app);

const turnRef=ref(db,"turn");
const callsRef=ref(db,"calls");
const winRef=ref(db,"winner");

let calledBy={}, myNums=[], gameOver=false;

myNums=Array.from({length:25},(_,i)=>i+1).sort(()=>Math.random()-0.5);
myNums.forEach(n=>{
 let d=document.createElement("div");
 d.className="cell";
 d.id="c"+n;
 d.innerText=n;
 board.appendChild(d);
});

onValue(turnRef,s=>turn.innerText=s.val()==="B"?"âœ… Your Turn":"â³ Player A Turn");

onValue(winRef,s=>{
 if(!s.exists()) return;
 gameOver=true;
 fx.style.display="block";
 winner.innerText=s.val()==="B"
  ?"ðŸŽ‰ SG blessed you to win the match"
  :"You never win sg";
});

function checkLines(){
 let g=myNums.map(n=>calledBy[n]?1:0);
 let lines=0;
 document.querySelectorAll(".cell").forEach(c=>c.classList.remove("win"));

 const wins=[];
 for(let r=0;r<5;r++){
  let idx=[r*5,r*5+1,r*5+2,r*5+3,r*5+4];
  if(idx.every(i=>g[i])){lines++;wins.push(idx);}
 }
 for(let c=0;c<5;c++){
  let idx=[c,c+5,c+10,c+15,c+20];
  if(idx.every(i=>g[i])){lines++;wins.push(idx);}
 }
 let d1=[0,6,12,18,24], d2=[4,8,12,16,20];
 if(d1.every(i=>g[i])){lines++;wins.push(d1);}
 if(d2.every(i=>g[i])){lines++;wins.push(d2);}

 wins.flat().forEach(i=>{
  let n=myNums[i];
  document.getElementById("c"+n)?.classList.add("win");
 });

 bingo.innerText="BINGO".slice(0,lines);
 return lines;
}

window.call=async function(){
 if(gameOver) return;
 let turnNow;
 onValue(turnRef,s=>turnNow=s.val(),{onlyOnce:true});
 if(turnNow!=="B") return alert("Wait turn");

 let n=num.value;
 if(!n||calledBy[n]) return alert("Invalid");

 push(callsRef,{num:n,by:"B"});
 set(turnRef,"A");
 num.value="";
};

window.resetGame=function(){
 remove(callsRef);
 remove(winRef);
 set(turnRef,"A");
 location.reload();
};

onChildAdded(callsRef,s=>{
 if(gameOver) return;

 let {num,by}=s.val();
 calledBy[num]=by;

 log.innerText+=" "+num;
 document.getElementById("c"+num)?.classList.add(by);

 if(checkLines()>=5) set(winRef,"B");
});
</script>

</body>
</html>
