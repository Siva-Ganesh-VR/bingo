<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player A</title>

<style>
body { font-family: Arial; text-align:center; padding:20px; }

.grid {
  display:grid;
  grid-template-columns: repeat(5, 60px);
  gap:5px;
  justify-content:center;
  margin:20px auto;
}

.cell {
  width:60px;
  height:60px;
  line-height:60px;
  border:1px solid #000;
  font-size:20px;
}

.marked { background:black; color:white; }

input, button { font-size:18px; padding:8px; margin:5px; }
#turn { font-weight:bold; font-size:20px; }
</style>
</head>

<body>

<h2>ðŸŽ¯ Player A</h2>
<div id="turn"></div>

<div class="grid" id="board"></div>

<input id="num" type="number" min="1" max="25" placeholder="1-25">
<button onclick="call()">Call</button>
<button onclick="resetGame()">Reset</button>

<h3>Numbers Called:</h3>
<div id="log"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, set, remove, get, onValue, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdcOpVzbZwKkbiSTHfsbYIecRuDbq9uns",
  authDomain: "bingo-sgthegreat.firebaseapp.com",
  databaseURL: "https://bingo-sgthegreat-default-rtdb.firebaseio.com",
  projectId: "bingo-sgthegreat"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const turnRef = ref(db,"turn");
const callsRef = ref(db,"calls");
const calledRef = ref(db,"calledNumbers");

set(turnRef,"A");

let currentTurn="";
let calledCache={};

// generate board
let nums=Array.from({length:25},(_,i)=>i+1).sort(()=>Math.random()-0.5);
nums.forEach(n=>{
  let d=document.createElement("div");
  d.className="cell";
  d.id="c"+n;
  d.innerText=n;
  board.appendChild(d);
});

// watch called numbers
onValue(calledRef,snap=>{
  calledCache=snap.val()||{};
});

// turn watcher
onValue(turnRef,snap=>{
  currentTurn=snap.val();
  turn.innerText=currentTurn==="A"?"âœ… Your Turn":"â³ Player B Turn";
});

// call number
window.call=async function(){
  if(currentTurn!=="A") return alert("Wait your turn");
  let n=num.value;
  if(!n) return;

  if(calledCache[n]) return alert("Already called!");

  await set(ref(db,"calledNumbers/"+n),true);
  push(callsRef,n);
  set(turnRef,"B");
  num.value="";
};

// reset
window.resetGame=function(){
  if(!confirm("Reset game?")) return;
  remove(callsRef);
  remove(calledRef);
  set(turnRef,"A");
  log.innerText="";
  document.querySelectorAll(".cell").forEach(c=>c.classList.remove("marked"));
};

// sync marks
onChildAdded(callsRef,snap=>{
  let n=snap.val();
  log.innerText+=" "+n;
  let cell=document.getElementById("c"+n);
  if(cell) cell.classList.add("marked");
});
</script>

</body>
</html>
